#!/bin/sh
#
# $Id: help2docbook,v 1.2 2003/06/11 18:40:23 jonas Exp $
#
# Script used to generate doc/book/config/cmdoptions.xml
# and hopefully other in the future.

target=$1
parse_option="please"
use_log=""
option_stack=""

# Functions

log()
{
	if test -n "$use_log";
	then
		echo $1
	fi
}

escape_string()
{
	echo $1 | sed -e "s/</\&lt;/" -e "s/>/\&gt;/"
}

# Da loop
echo "<!-- Generated by $0. DO NOT EDIT! -->"
echo "<variablelist>"

while read line
do
	if test -z "$parse_option"
	then
		# If the line is empty it is our clue that
		# the desciption is over.
		if test -z "$line"
		then
			echo "</para></listitem></varlistentry>"
			parse_option="please"
			continue
		fi

		# Make escapes
		escape_string "$line"
		continue
	fi

	# Handle special case for -h and -?
	case "$line" in
	-h | -?)
		if test -z "$option_stack";
		then
			option_stack="$line,"
		else
			option_stack="$option_stack $line,"
		fi
		;;
	-[a-z]*)
		parse_option=""
		# We got our option
		echo "<varlistentry><term> $option_stack $(escape_string "$line") </term><listitem><para>"
		option_stack=""
		;;
	*)
		;;
	esac
done

echo "</variablelist>"
